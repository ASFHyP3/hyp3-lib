[tox]
envlist = py27, py36, py37, py38

[testenv]
conda_deps =
     boto3
     gdal
     imageio
     lxml
     netCDF4
     matplotlib
     numpy
     pillow
     proj4
     requests
     scipy
     six
     statsmodels
conda_channels =
    conda-forge
deps =
    importlib_metadata
    s3pypi
    setuptools
    setuptools-scm[toml]
    twine
    wheel
extras =
    develop
commands =
    pytest {posargs}

[testenv:py37-verify]
passenv =
    S3_PYPI_HOST
    SDIST_VERSION
whitelist_externals =
    /usr/bin/bash
skipinstall =
    true
commands =
    python3 -m pip install hyp3lib --trusted-host "{env:S3_PYPI_HOST:}" --extra-index-url "http://{env:S3_PYPI_HOST:}"
    bash -ec 'if [[ {env:SDIST_VERSION:} != $(python3 -c "import hyp3lib; print(hyp3lib.__version__);") ]]; then exit 1; else exit 0; fi'